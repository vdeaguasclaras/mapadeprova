<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Marista √Åguas Claras</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #dbeafe 0%, #e0e7ff 100%);
        }
        .card-shadow {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .hover-scale:hover {
            transform: scale(1.02);
            transition: transform 0.2s ease-in-out;
        }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <!-- Tela de Importa√ß√£o -->
    <div id="telaImportacao" class="min-h-screen p-6">
        <div class="max-w-4xl mx-auto">
            <div class="bg-white rounded-2xl card-shadow p-8 text-center">
                <div class="mb-8">
                    <div class="bg-blue-100 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-6">
                        <svg class="w-10 h-10 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                    </div>
                    <h1 class="text-3xl font-bold text-gray-800 mb-2">Sistema de An√°lise Acad√™mica</h1>
                    <p class="text-lg text-gray-600">Marista √Åguas Claras</p>
                </div>
                
                <div class="border-2 border-dashed border-blue-300 rounded-xl p-8 mb-6 bg-blue-50 hover:bg-blue-100 transition-colors">
                    <svg class="w-12 h-12 mx-auto mb-4 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                    </svg>
                    <h2 class="text-xl font-semibold text-gray-700 mb-2">Importar Dados dos Estudantes</h2>
                    <p class="text-gray-600 mb-6">Selecione o arquivo CSV exportado do sistema escolar</p>
                    <label class="bg-blue-600 hover:bg-blue-700 text-white px-8 py-3 rounded-lg cursor-pointer inline-flex items-center gap-3 transition-colors card-shadow hover-scale">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                        </svg>
                        Selecionar Arquivo CSV
                        <input type="file" id="csvFile" accept=".csv" class="hidden">
                    </label>
                </div>
                
                <div class="bg-gray-50 rounded-lg p-6 text-left">
                    <h3 class="font-semibold text-gray-800 mb-3">üìã Formato do arquivo CSV:</h3>
                    <ul class="text-sm text-gray-600 space-y-2">
                        <li>‚Ä¢ <strong>Colunas obrigat√≥rias:</strong> NOME_COMPL, TURMA, NOME_DISCIPLINA</li>
                        <li>‚Ä¢ <strong>Notas por etapa:</strong> E1_P1, E1_P2, E1_P3, E1_P4, ETAPA1</li>
                        <li>‚Ä¢ <strong>Segunda etapa:</strong> E2_P1, E2_P2, E2_P3, E2_P4, ETAPA2</li>
                        <li>‚Ä¢ <strong>M√©dia final:</strong> MF</li>
                        <li>‚Ä¢ <strong>Separador:</strong> Ponto e v√≠rgula (;)</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Tela de Sele√ß√£o -->
    <div id="telaSelecao" class="min-h-screen p-6 hidden">
        <div class="max-w-4xl mx-auto">
            <div class="bg-white rounded-2xl card-shadow p-8">
                <div class="text-center mb-8">
                    <div class="bg-green-100 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-6">
                        <svg class="w-10 h-10 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                        </svg>
                    </div>
                    <h1 class="text-3xl font-bold text-gray-800 mb-2">Dados Importados com Sucesso!</h1>
                    <p class="text-lg text-gray-600">Selecione um estudante para an√°lise detalhada</p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div class="bg-blue-50 rounded-xl p-6 text-center">
                        <div id="totalEstudantes" class="text-2xl font-bold text-blue-600 mb-2">0</div>
                        <div class="text-blue-800 font-medium">Estudantes</div>
                    </div>
                    <div class="bg-green-50 rounded-xl p-6 text-center">
                        <div id="totalDisciplinas" class="text-2xl font-bold text-green-600 mb-2">0</div>
                        <div class="text-green-800 font-medium">Disciplinas</div>
                    </div>
                    <div class="bg-purple-50 rounded-xl p-6 text-center">
                        <div id="totalRegistros" class="text-2xl font-bold text-purple-600 mb-2">0</div>
                        <div class="text-purple-800 font-medium">Registros</div>
                    </div>
                </div>

                <div class="mb-8">
                    <label class="block text-lg font-semibold text-gray-700 mb-4">Escolha o estudante para an√°lise:</label>
                    <select id="selectEstudante" class="w-full border-2 border-gray-300 rounded-xl px-4 py-3 text-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <option value="">-- Selecione um estudante --</option>
                    </select>
                </div>

                <div class="flex gap-4 justify-center">
                    <button id="btnVoltarImportacao" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-lg flex items-center gap-2 transition-colors">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                        </svg>
                        Importar Outro Arquivo
                    </button>
                    
                    <button id="btnAnalisar" class="bg-blue-600 hover:bg-blue-700 text-white px-8 py-3 rounded-lg flex items-center gap-2 transition-colors card-shadow hidden">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                        </svg>
                        Analisar Estudante
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Tela de An√°lise -->
    <div id="telaAnalise" class="min-h-screen p-6 hidden">
        <div class="max-w-7xl mx-auto">
            <!-- Header -->
            <div class="bg-white rounded-2xl card-shadow p-6 mb-6">
                <div class="flex items-center justify-between">
                    <button id="btnVoltarSelecao" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-colors">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                        </svg>
                        Voltar
                    </button>
                    
                    <div class="text-center">
                        <h1 id="nomeEstudante" class="text-2xl font-bold text-gray-800"></h1>
                        <p id="turmaEstudante" class="text-gray-600"></p>
                    </div>
                    
                    <div class="text-right">
                        <p class="text-sm text-gray-500">Ano Letivo 2025</p>
                        <p class="text-lg font-semibold text-blue-600">3¬∫ Ano EM</p>
                    </div>
                </div>
            </div>

            <!-- Panorama Geral -->
            <div class="bg-white rounded-xl card-shadow p-6 mb-6">
                <div class="flex items-center gap-2 mb-6">
                    <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"></path>
                    </svg>
                    <h2 class="text-xl font-bold text-gray-800">Panorama Geral</h2>
                </div>

                <div id="cardsResumo" class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
                    <!-- Cards ser√£o inseridos via JavaScript -->
                </div>

                <div id="statusDisciplinas" class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <!-- Status ser√° inserido via JavaScript -->
                </div>
            </div>

            <!-- An√°lise por Disciplina -->
            <div class="bg-white rounded-xl card-shadow p-6">
                <div class="flex items-center gap-2 mb-6">
                    <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
                    </svg>
                    <h2 class="text-xl font-bold text-gray-800">An√°lise por Disciplina</h2>
                </div>

                <div id="disciplinasContainer" class="space-y-6">
                    <!-- Disciplinas ser√£o inseridas via JavaScript -->
                </div>

                <!-- Insights -->
                <div class="mt-8 bg-blue-50 border border-blue-200 rounded-xl p-6">
                    <div class="flex items-center gap-2 mb-4">
                        <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                        </svg>
                        <h3 class="font-bold text-blue-800">üí° Insights e Recomenda√ß√µes</h3>
                    </div>
                    
                    <div id="insightsContainer" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- Insights ser√£o inseridos via JavaScript -->
                    </div>
                    
                    <div id="resumoGeral" class="mt-4 p-4 bg-white rounded-lg">
                        <!-- Resumo ser√° inserido via JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Footer -->
            <div class="text-center mt-8 p-4 text-gray-500 text-sm">
                <p>Sistema de An√°lise Acad√™mica Individual - Marista √Åguas Claras</p>
                <p>Desenvolvido para acompanhamento detalhado do desenvolvimento estudantil</p>
            </div>
        </div>
    </div>

    <script>
        // Vari√°veis globais
        let dadosOriginais = [];
        let estudanteSelecionado = '';
        let telaAtual = 'importacao';

        // Fun√ß√£o para processar CSV
        function processarCSV(texto) {
            const linhas = texto.split('\n').filter(linha => linha.trim());
            const cabecalho = linhas[0].split(';').map(col => col.trim());
            
            const dados = [];
            for (let i = 1; i < linhas.length; i++) {
                const valores = linhas[i].split(';');
                if (valores.length >= cabecalho.length) {
                    const registro = {};
                    cabecalho.forEach((col, index) => {
                        let valor = valores[index]?.trim() || '';
                        if (['E1_P1', 'E1_P2', 'E1_P3', 'E1_P4', 'ETAPA1', 'MEDIA1', 'E2_P1', 'E2_P2', 'E2_P3', 'E2_P4', 'ETAPA2', 'MED_AC', 'MEDIA2', 'MA', 'MF'].includes(col)) {
                            valor = valor === '' || valor === 'null' ? null : parseFloat(valor.replace(',', '.'));
                        }
                        registro[col] = valor;
                    });
                    dados.push(registro);
                }
            }
            return dados;
        }

        // Fun√ß√£o para processar dados
        function processarDados() {
            if (!dadosOriginais.length) return {
                dadosValidos: [],
                estudantes: [],
                disciplinas: []
            };

            const dadosValidos = dadosOriginais.filter(row => 
                row.MF !== null && row.MF !== undefined && !isNaN(row.MF)
            );

            const estudantes = [...new Set(dadosOriginais.map(row => row.NOME_COMPL))].filter(Boolean).sort();
            const disciplinas = [...new Set(dadosOriginais.map(row => row.NOME_DISCIPLINA))].filter(Boolean).sort();

            return {
                dadosValidos,
                estudantes,
                disciplinas
            };
        }

        // Fun√ß√£o para mostrar tela
        function mostrarTela(tela) {
            document.getElementById('telaImportacao').classList.add('hidden');
            document.getElementById('telaSelecao').classList.add('hidden');
            document.getElementById('telaAnalise').classList.add('hidden');
            
            document.getElementById(`tela${tela.charAt(0).toUpperCase() + tela.slice(1)}`).classList.remove('hidden');
            telaAtual = tela;
        }

        // Fun√ß√£o para carregar lista de estudantes
        function carregarEstudantes() {
            const dados = processarDados();
            const select = document.getElementById('selectEstudante');
            
            // Limpar options
            select.innerHTML = '<option value="">-- Selecione um estudante --</option>';
            
            // Adicionar estudantes
            dados.estudantes.forEach(estudante => {
                const option = document.createElement('option');
                option.value = estudante;
                option.textContent = estudante;
                select.appendChild(option);
            });

            // Atualizar estat√≠sticas
            document.getElementById('totalEstudantes').textContent = dados.estudantes.length;
            document.getElementById('totalDisciplinas').textContent = dados.disciplinas.length;
            document.getElementById('totalRegistros').textContent = dados.dadosValidos.length;
        }

        // Fun√ß√£o para analisar estudante
        function analisarEstudante(nomeEstudante) {
            const dados = processarDados();
            const notasEstudante = dados.dadosValidos.filter(row => 
                row.NOME_COMPL === nomeEstudante
            );

            if (!notasEstudante.length) return null;

            const turmaEstudante = notasEstudante[0].TURMA;
            
            // Calcular m√©dias do estudante
            const mediaEstudante = notasEstudante.reduce((sum, row) => sum + row.MF, 0) / notasEstudante.length;
            const mediaEtapa1 = notasEstudante.filter(row => row.ETAPA1 !== null).reduce((sum, row) => sum + row.ETAPA1, 0) / notasEstudante.filter(row => row.ETAPA1 !== null).length;
            const mediaEtapa2 = notasEstudante.filter(row => row.ETAPA2 !== null).reduce((sum, row) => sum + row.ETAPA2, 0) / notasEstudante.filter(row => row.ETAPA2 !== null).length;

            // Calcular m√©dias da turma
            const dadosTurma = dados.dadosValidos.filter(row => row.TURMA === turmaEstudante);
            const mediaTurmaGeral = dadosTurma.reduce((sum, row) => sum + row.MF, 0) / dadosTurma.length;
            const mediaTurmaEtapa1 = dadosTurma.filter(row => row.ETAPA1 !== null).reduce((sum, row) => sum + row.ETAPA1, 0) / dadosTurma.filter(row => row.ETAPA1 !== null).length;
            const mediaTurmaEtapa2 = dadosTurma.filter(row => row.ETAPA2 !== null).reduce((sum, row) => sum + row.ETAPA2, 0) / dadosTurma.filter(row => row.ETAPA2 !== null).length;

            // An√°lise por disciplina
            const disciplinasDetalhadas = notasEstudante.map(nota => {
                const dadosTurmaDisciplina = dadosTurma.filter(row => row.NOME_DISCIPLINA === nota.NOME_DISCIPLINA);
                const mediaTurmaDisciplina = dadosTurmaDisciplina.reduce((sum, row) => sum + row.MF, 0) / dadosTurmaDisciplina.length;
                const mediaTurmaE1Disc = dadosTurmaDisciplina.filter(row => row.ETAPA1 !== null).reduce((sum, row) => sum + row.ETAPA1, 0) / dadosTurmaDisciplina.filter(row => row.ETAPA1 !== null).length;
                const mediaTurmaE2Disc = dadosTurmaDisciplina.filter(row => row.ETAPA2 !== null).reduce((sum, row) => sum + row.ETAPA2, 0) / dadosTurmaDisciplina.filter(row => row.ETAPA2 !== null).length;

                return {
                    disciplina: nota.NOME_DISCIPLINA,
                    notaFinal: nota.MF,
                    etapa1: nota.ETAPA1,
                    etapa2: nota.ETAPA2,
                    provasE1: {
                        P1: nota.E1_P1,
                        P2: nota.E1_P2, 
                        P3: nota.E1_P3,
                        P4: nota.E1_P4
                    },
                    provasE2: {
                        P1: nota.E2_P1,
                        P2: nota.E2_P2,
                        P3: nota.E2_P3,
                        P4: nota.E2_P4
                    },
                    mediaTurmaDisciplina,
                    mediaTurmaE1: mediaTurmaE1Disc,
                    mediaTurmaE2: mediaTurmaE2Disc,
                    situacao: nota.MF >= 6 ? 'Aprovado' : nota.MF >= 4 ? 'Recupera√ß√£o' : 'Reprovado',
                    desempenhoGeral: nota.MF - mediaTurmaDisciplina,
                    desempenhoE1: nota.ETAPA1 ? nota.ETAPA1 - mediaTurmaE1Disc : null,
                    desempenhoE2: nota.ETAPA2 ? nota.ETAPA2 - mediaTurmaE2Disc : null
                };
            });

            return {
                nome: nomeEstudante,
                turma: turmaEstudante,
                mediaGeral: mediaEstudante,
                mediaEtapa1: mediaEtapa1 || null,
                mediaEtapa2: mediaEtapa2 || null,
                mediaTurmaGeral,
                mediaTurmaEtapa1: mediaTurmaEtapa1 || null,
                mediaTurmaEtapa2: mediaTurmaEtapa2 || null,
                disciplinas: disciplinasDetalhadas,
                resumo: {
                    aprovado: disciplinasDetalhadas.filter(d => d.situacao === 'Aprovado').length,
                    recuperacao: disciplinasDetalhadas.filter(d => d.situacao === 'Recupera√ß√£o').length,
                    reprovado: disciplinasDetalhadas.filter(d => d.situacao === 'Reprovado').length,
                    totalDisciplinas: disciplinasDetalhadas.length
                }
            };
        }

        // Fun√ß√£o para renderizar an√°lise
        function renderizarAnalise(dadosEstudante) {
            // Header
            document.getElementById('nomeEstudante').textContent = dadosEstudante.nome;
            document.getElementById('turmaEstudante').textContent = `${dadosEstudante.turma} ‚Ä¢ Marista √Åguas Claras`;

            // Cards resumo
            const cardsResumo = document.getElementById('cardsResumo');
            cardsResumo.innerHTML = `
                <div class="bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-xl p-6">
                    <div class="text-blue-100 text-sm mb-1">M√©dia Final</div>
                    <div class="text-3xl font-bold mb-2">${dadosEstudante.mediaGeral.toFixed(1)}</div>
                    <div class="text-sm">
                        ${dadosEstudante.mediaGeral > dadosEstudante.mediaTurmaGeral ? 
                            `+${(dadosEstudante.mediaGeral - dadosEstudante.mediaTurmaGeral).toFixed(1)} vs turma` :
                            `${(dadosEstudante.mediaGeral - dadosEstudante.mediaTurmaGeral).toFixed(1)} vs turma`
                        }
                    </div>
                </div>
                ${dadosEstudante.mediaEtapa1 ? `
                <div class="bg-gradient-to-r from-green-500 to-green-600 text-white rounded-xl p-6">
                    <div class="text-green-100 text-sm mb-1">M√©dia Etapa 1</div>
                    <div class="text-3xl font-bold mb-2">${dadosEstudante.mediaEtapa1.toFixed(1)}</div>
                    <div class="text-sm">
                        ${dadosEstudante.mediaEtapa1 > dadosEstudante.mediaTurmaEtapa1 ? 
                            `+${(dadosEstudante.mediaEtapa1 - dadosEstudante.mediaTurmaEtapa1).toFixed(1)} vs turma` :
                            `${(dadosEstudante.mediaEtapa1 - dadosEstudante.mediaTurmaEtapa1).toFixed(1)} vs turma`
                        }
                    </div>
                </div>
                ` : ''}
                ${dadosEstudante.mediaEtapa2 ? `
                <div class="bg-gradient-to-r from-purple-500 to-purple-600 text-white rounded-xl p-6">
                    <div class="text-purple-100 text-sm mb-1">M√©dia Etapa 2</div>
                    <div class="text-3xl font-bold mb-2">${dadosEstudante.mediaEtapa2.toFixed(1)}</div>
                    <div class="text-sm">
                        ${dadosEstudante.mediaEtapa2 > dadosEstudante.mediaTurmaEtapa2 ? 
                            `+${(dadosEstudante.mediaEtapa2 - dadosEstudante.mediaTurmaEtapa2).toFixed(1)} vs turma` :
                            `${(dadosEstudante.mediaEtapa2 - dadosEstudante.mediaTurmaEtapa2).toFixed(1)} vs turma`
                        }
                    </div>
                </div>
                ` : ''}
                <div class="bg-gradient-to-r from-orange-500 to-orange-600 text-white rounded-xl p-6">
                    <div class="text-orange-100 text-sm mb-1">Situa√ß√£o</div>
                    <div class="text-2xl font-bold mb-2">${dadosEstudante.resumo.aprovado}/${dadosEstudante.resumo.totalDisciplinas}</div>
                    <div class="text-sm">Disciplinas aprovadas</div>
                </div>
            `;

            // Status das disciplinas
            const statusDisciplinas = document.getElementById('statusDisciplinas');
            statusDisciplinas.innerHTML = `
                <div class="bg-green-50 border-2 border-green-200 rounded-xl p-4 text-center">
                    <div class="text-green-600 text-2xl font-bold mb-1">${dadosEstudante.resumo.aprovado}</div>
                    <div class="text-green-700 font-medium">Aprovado</div>
                    <div class="text-green-600 text-sm">‚â• 6.0</div>
                </div>
                <div class="bg-yellow-50 border-2 border-yellow-200 rounded-xl p-4 text-center">
                    <div class="text-yellow-600 text-2xl font-bold mb-1">${dadosEstudante.resumo.recuperacao}</div>
                    <div class="text-yellow-700 font-medium">Recupera√ß√£o</div>
                    <div class="text-yellow-600 text-sm">4.0 - 5.9</div>
                </div>
                <div class="bg-red-50 border-2 border-red-200 rounded-xl p-4 text-center">
                    <div class="text-red-600 text-2xl font-bold mb-1">${dadosEstudante.resumo.reprovado}</div>
                    <div class="text-red-700 font-medium">Reprovado</div>
                    <div class="text-red-600 text-sm">< 4.0</div>
                </div>
            `;

            // Disciplinas
            const disciplinasContainer = document.getElementById('disciplinasContainer');
            disciplinasContainer.innerHTML = dadosEstudante.disciplinas.map(disciplina => `
                <div class="border border-gray-200 rounded-xl p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-bold text-gray-800">${disciplina.disciplina}</h3>
                        <span class="px-3 py-1 rounded-full text-sm font-semibold ${
                            disciplina.situacao === 'Aprovado' ? 'bg-green-100 text-green-800' :
                            disciplina.situacao === 'Recupera√ß√£o' ? 'bg-yellow-100 text-yellow-800' :
                            'bg-red-100 text-red-800'
                        }">
                            ${disciplina.situacao}
                        </span>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                        <div class="bg-blue-50 rounded-lg p-4">
                            <div class="text-blue-600 text-sm font-medium mb-1">M√©dia Final</div>
                            <div class="text-2xl font-bold text-blue-800">${disciplina.notaFinal.toFixed(1)}</div>
                            <div class="text-sm ${disciplina.desempenhoGeral >= 0 ? 'text-green-600' : 'text-red-600'}">
                                ${disciplina.desempenhoGeral >= 0 ? '+' : ''}${disciplina.desempenhoGeral.toFixed(1)} vs turma
                            </div>
                        </div>

                        ${disciplina.etapa1 ? `
                        <div class="bg-green-50 rounded-lg p-4">
                            <div class="text-green-600 text-sm font-medium mb-1">Etapa 1</div>
                            <div class="text-2xl font-bold text-green-800">${disciplina.etapa1.toFixed(1)}</div>
                            <div class="text-sm ${disciplina.desempenhoE1 >= 0 ? 'text-green-600' : 'text-red-600'}">
                                ${disciplina.desempenhoE1 >= 0 ? '+' : ''}${disciplina.desempenhoE1?.toFixed(1)} vs turma
                            </div>
                        </div>
                        ` : ''}

                        ${disciplina.etapa2 ? `
                        <div class="bg-purple-50 rounded-lg p-4">
                            <div class="text-purple-600 text-sm font-medium mb-1">Etapa 2</div>
                            <div class="text-2xl font-bold text-purple-800">${disciplina.etapa2.toFixed(1)}</div>
                            <div class="text-sm ${disciplina.desempenhoE2 >= 0 ? 'text-green-600' : 'text-red-600'}">
                                ${disciplina.desempenhoE2 >= 0 ? '+' : ''}${disciplina.desempenhoE2?.toFixed(1)} vs turma
                            </div>
                        </div>
                        ` : ''}
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="bg-gray-50 rounded-lg p-4">
                            <h4 class="font-semibold text-gray-800 mb-3">üìö Etapa 1 - Provas</h4>
                            <div class="space-y-3">
                                ${Object.entries(disciplina.provasE1).map(([prova, nota]) => {
                                    if (nota === null) return '';
                                    return `
                                    <div class="flex items-center justify-between bg-white rounded-lg p-3">
                                        <span class="font-medium text-gray-700">${prova}</span>
                                        <div class="text-right">
                                            <div class="font-bold text-gray-800">${nota.toFixed(1)}</div>
                                        </div>
                                    </div>
                                    `;
                                }).join('')}
                                ${disciplina.etapa1 ? `
                                <div class="border-t pt-3 mt-3">
                                    <div class="flex items-center justify-between bg-green-100 rounded-lg p-3">
                                        <span class="font-bold text-green-800">M√©dia Etapa 1</span>
                                        <div class="text-right">
                                            <div class="font-bold text-green-800">${disciplina.etapa1.toFixed(1)}</div>
                                            <div class="text-xs text-green-600">
                                                Turma: ${disciplina.mediaTurmaE1.toFixed(1)}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                ` : ''}
                            </div>
                        </div>

                        <div class="bg-gray-50 rounded-lg p-4">
                            <h4 class="font-semibold text-gray-800 mb-3">üìö Etapa 2 - Provas</h4>
                            <div class="space-y-3">
                                ${Object.entries(disciplina.provasE2).map(([prova, nota]) => {
                                    if (nota === null) return '';
                                    return `
                                    <div class="flex items-center justify-between bg-white rounded-lg p-3">
                                        <span class="font-medium text-gray-700">${prova}</span>
                                        <div class="text-right">
                                            <div class="font-bold text-gray-800">${nota.toFixed(1)}</div>
                                        </div>
                                    </div>
                                    `;
                                }).join('')}
                                ${disciplina.etapa2 ? `
                                <div class="border-t pt-3 mt-3">
                                    <div class="flex items-center justify-between bg-purple-100 rounded-lg p-3">
                                        <span class="font-bold text-purple-800">M√©dia Etapa 2</span>
                                        <div class="text-right">
                                            <div class="font-bold text-purple-800">${disciplina.etapa2.toFixed(1)}</div>
                                            <div class="text-xs text-purple-600">
                                                Turma: ${disciplina.mediaTurmaE2.toFixed(1)}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                ` : ''}
                            </div>
                        </div>
                    </div>

                    <div class="mt-4">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-sm font-medium text-gray-700">Performance vs Turma</span>
                            <span class="text-sm font-semibold ${
                                disciplina.desempenhoGeral >= 1 ? 'text-green-600' :
                                disciplina.desempenhoGeral >= -1 ? 'text-yellow-600' : 'text-red-600'
                            }">
                                ${disciplina.desempenhoGeral >= 1 ? 'Acima da M√©dia' :
                                 disciplina.desempenhoGeral >= -1 ? 'Na M√©dia' : 'Abaixo da M√©dia'}
                            </span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-3">
                            <div 
                                class="h-3 rounded-full ${
                                    disciplina.desempenhoGeral >= 1 ? 'bg-green-500' :
                                    disciplina.desempenhoGeral >= -1 ? 'bg-yellow-500' : 'bg-red-500'
                                }"
                                style="width: ${Math.min(Math.max((disciplina.notaFinal / 10) * 100, 5), 100)}%"
                            ></div>
                        </div>
                        <div class="flex justify-between text-xs text-gray-500 mt-1">
                            <span>0.0</span>
                            <span>5.0</span>
                            <span>10.0</span>
                        </div>
                    </div>
                </div>
            `).join('');

            // Insights
            const pontosFortes = dadosEstudante.disciplinas.filter(d => d.desempenhoGeral >= 1).slice(0, 3);
            const atencaoNecessaria = dadosEstudante.disciplinas.filter(d => d.desempenhoGeral < -1 || d.notaFinal < 6).slice(0, 3);

            const insightsContainer = document.getElementById('insightsContainer');
            insightsContainer.innerHTML = `
                <div>
                    <h4 class="font-semibold text-green-800 mb-2">üåü Pontos Fortes:</h4>
                    <ul class="text-sm text-green-700 space-y-1">
                        ${pontosFortes.length > 0 ? 
                            pontosFortes.map(d => `<li>‚Ä¢ ${d.disciplina} (+${d.desempenhoGeral.toFixed(1)} vs turma)</li>`).join('') :
                            '<li>‚Ä¢ Continue se esfor√ßando para melhorar o desempenho</li>'
                        }
                    </ul>
                </div>
                
                <div>
                    <h4 class="font-semibold text-red-800 mb-2">‚ö†Ô∏è Aten√ß√£o Necess√°ria:</h4>
                    <ul class="text-sm text-red-700 space-y-1">
                        ${atencaoNecessaria.length > 0 ? 
                            atencaoNecessaria.map(d => `<li>‚Ä¢ ${d.disciplina} (${d.notaFinal.toFixed(1)} - ${d.situacao})</li>`).join('') :
                            '<li>‚Ä¢ Parab√©ns! Todas as disciplinas est√£o em bom desempenho</li>'
                        }
                    </ul>
                </div>
            `;

            // Resumo geral
            const resumoGeral = document.getElementById('resumoGeral');
            resumoGeral.innerHTML = `
                <div class="text-sm text-gray-700">
                    <strong>üìä Resumo Geral:</strong> O estudante est√° com m√©dia ${dadosEstudante.mediaGeral.toFixed(1)}, 
                    ${dadosEstudante.mediaGeral > dadosEstudante.mediaTurmaGeral ? ' acima' : ' abaixo'} da m√©dia da turma (${dadosEstudante.mediaTurmaGeral.toFixed(1)}). 
                    Tem ${dadosEstudante.resumo.aprovado} disciplinas aprovadas de ${dadosEstudante.resumo.totalDisciplinas} total.
                    ${dadosEstudante.resumo.recuperacao > 0 ? ` Aten√ß√£o para ${dadosEstudante.resumo.recuperacao} disciplina(s) em recupera√ß√£o.` : ''}
                    ${dadosEstudante.resumo.reprovado > 0 ? ` Foco especial em ${dadosEstudante.resumo.reprovado} disciplina(s) reprovadas.` : ''}
                </div>
            `;
        }

        // Event Listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Upload de arquivo
            document.getElementById('csvFile').addEventListener('change', function(event) {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const texto = e.target.result;
                        dadosOriginais = processarCSV(texto);
                        carregarEstudantes();
                        mostrarTela('selecao');
                    };
                    reader.readAsText(file, 'UTF-8');
                }
            });

            // Sele√ß√£o de estudante
            document.getElementById('selectEstudante').addEventListener('change', function() {
                estudanteSelecionado = this.value;
                const btnAnalisar = document.getElementById('btnAnalisar');
                if (estudanteSelecionado) {
                    btnAnalisar.classList.remove('hidden');
                } else {
                    btnAnalisar.classList.add('hidden');
                }
            });

            // Bot√µes de navega√ß√£o
            document.getElementById('btnVoltarImportacao').addEventListener('click', function() {
                mostrarTela('importacao');
                estudanteSelecionado = '';
                dadosOriginais = [];
            });

            document.getElementById('btnAnalisar').addEventListener('click', function() {
                if (estudanteSelecionado) {
                    const dadosEstudante = analisarEstudante(estudanteSelecionado);
                    if (dadosEstudante) {
                        renderizarAnalise(dadosEstudante);
                        mostrarTela('analise');
                    }
                }
            });

            document.getElementById('btnVoltarSelecao').addEventListener('click', function() {
                mostrarTela('selecao');
            });

            // Verificar se h√° dados de exemplo (simula√ß√£o)
            if (window.location.search.includes('demo=true')) {
                // Dados de exemplo para demonstra√ß√£o
                dadosOriginais = [
                    {
                        NOME_COMPL: "JO√ÉO SILVA SANTOS",
                        TURMA: "EM-3¬™A-M",
                        NOME_DISCIPLINA: "MATEM√ÅTICA",
                        E1_P1: 7.5, E1_P2: 8.0, E1_P3: 6.5, E1_P4: 7.0,
                        ETAPA1: 7.25, E2_P1: 8.5, E2_P2: 7.0, ETAPA2: 7.75, MF: 7.5
                    },
                    {
                        NOME_COMPL: "JO√ÉO SILVA SANTOS",
                        TURMA: "EM-3¬™A-M", 
                        NOME_DISCIPLINA: "PORTUGU√äS",
                        E1_P1: 6.0, E1_P2: 7.5, E1_P3: 5.5, E1_P4: 6.5,
                        ETAPA1: 6.4, E2_P1: 7.0, E2_P2: 6.0, ETAPA2: 6.5, MF: 6.45
                    },
                    {
                        NOME_COMPL: "MARIA OLIVEIRA COSTA",
                        TURMA: "EM-3¬™A-M",
                        NOME_DISCIPLINA: "MATEM√ÅTICA", 
                        E1_P1: 5.5, E1_P2: 6.0, E1_P3: 4.5, E1_P4: 5.0,
                        ETAPA1: 5.25, E2_P1: 6.5, E2_P2: 5.5, ETAPA2: 6.0, MF: 5.6
                    }
                ];
                carregarEstudantes();
                mostrarTela('selecao');
            }
        });
    </script>
</body>
</html>
